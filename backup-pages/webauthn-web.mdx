## WebAuthn Module

The WebAuthn Module and it's members are accessible on the Magic SDK instance by the `webauthn` property.

To use the WebAuthn Module in your application, install `@magic-ext/webauthn` along with `magic-sdk`.

```javascript JavaScript icon="square-js"
import { Magic } from "magic-sdk";
import { WebAuthnExtension } from "@magic-ext/webauthn";

const magic = new Magic('PUBLISHABLE_API_KEY', {
  extensions: [new WebAuthnExtension()],
});

magic.webauthn;
magic.webauthn.registerNewUser;
magic.webauthn.login;
magic.webauthn.getMetadata;
magic.webauthn.registerNewDevice;
magic.webauthn.updateInfo;
magic.webauthn.unregisterDevice;
```

### `registerNewUser`

Registers a new WebAuthn user.

**Arguments**

- `username` (String): The username to register with
- `nickname?` (String): The nickname of the WebAuthn device the user wants to set

**Returns**

- `PromiEvent<string | null>`: The promise resolves upon authentication request success and rejects with a specific error code if the request fails. The resolved value is a Decentralized ID token with a default 15-minute lifespan.

**Example**

```javascript JavaScript icon="square-js"
import { Magic } from "magic-sdk";
import { WebAuthnExtension } from "@magic-ext/webauthn";

const magic = new Magic('YOUR API KEY', {
  extensions: [new WebAuthnExtension()],
});

// register a user by their username
try {
  const token = await magic.webauthn.registerNewUser({ username: 'username' });
} catch (e) {
  // Handle errors if required!
}

// log in a user by their username and set webauthn device nickname.
try {
  const token = await magic.webauthn.registerNewUser({ username: 'username', nickname: 'nickname' });
} catch (e) {
  // Handle errors if required!
}
```

**Error**

```javascript JavaScript icon="square-js"
import { Magic, SDKErrorCode } from "magic-sdk";
import { WebAuthnExtension } from "@magic-ext/webauthn";

const magic = new Magic('YOUR API KEY', {
  extensions: [new WebAuthnExtension()],
});

try {
  await magic.webauthn.registerNewUser({ username: 'username' });
} catch (err) {
  if (err instanceof SDKErrorCode) {
    switch (err.code) {
      case SDKErrorCode.WebAuthnNotSupported:
      case SDKErrorCode.WebAuthnCreateCredentialError:
      // Handle errors accordingly
      break;
    }
  }
}
```

### `login`

Logs in a registered WebAuthn user.

**Arguments**

- `username` (String): The username to log in with

**Returns**

- `PromiEvent<string | null>`: The promise resolves upon authentication request success and rejects with a specific error code if the request fails. The resolved value is a Decentralized ID token with a default 15-minute lifespan.

**Example**

```javascript JavaScript icon="square-js"
import { Magic } from "magic-sdk";
import { WebAuthnExtension } from "@magic-ext/webauthn";

const magic = new Magic('YOUR API KEY', {
extensions: [new WebAuthnExtension()],
});

// login a user by their username
try {
  const token = await magic.webauthn.login({ username: 'username' });
} catch (e) {
  // Handle errors if required!
}
```

**Error**

```javascript JavaScript icon="square-js"
import { Magic, SDKErrorCode } from "magic-sdk";
import { WebAuthnExtension } from "@magic-ext/webauthn";

const magic = new Magic('YOUR API KEY', {
  extensions: [new WebAuthnExtension()],
});

try {
  await magic.webauthn.login({ username: 'username' });
} catch (err) {
  if (err instanceof SDKErrorCode) {
    switch (err.code) {
      case SDKErrorCode.WebAuthnNotSupported:
      case SDKErrorCode.WebAuthnCreateCredentialError:
      // Handle errors accordingly
      break;
    }
  }
}
```

### `getMetadata`

Returns information about the currently logged in user.

**Arguments**

- _None_

**Returns**

- `PromiEvent<object | null>`: an object containing the WebAuthn devices information and username of the authenticated user
  - `devicesInfo` (Array): List of devices info contains device ID, device nickname, transport, user agent
  - `username` (String): Username of the authenticated user

**Example**

```javascript JavaScript icon="square-js"
import { Magic, SDKErrorCode } from "magic-sdk";
import { WebAuthnExtension } from "@magic-ext/webauthn";

const magic = new Magic('YOUR API KEY', {
  extensions: [new WebAuthnExtension()],
});

// Initiates the flow to get webauthn metadata for current account.
try {
  const metadata = await magic.webauthn.getMetadata();

  // webauthn metadata
  {
    "devicesInfo": [
      {
      "id": "EjI_EFJhB6cdCj6rHPRHUcFCn6NnywALuWjQyPe0_dI=",
      "nickname": "",
      "transport": "internal",
      "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36"
      }
    ],
    "username": "username"
  }

} catch (e) {
  // Handle errors if required!
}
```

### `registerNewDevice`

Registers a new WebAuthn device.

**Arguments**

- `nickname` (String): The nickname of the WebAuthn device the user wants to set

**Returns**

- `PromiEvent<boolean>`: The promise resolves with a true boolean value if register webauthn device is successful and rejects with a specific error code if the request fails.

**Example**

```javascript JavaScript icon="square-js"
import { Magic, SDKErrorCode } from "magic-sdk";
import { WebAuthnExtension } from "@magic-ext/webauthn";

const magic = new Magic('YOUR API KEY', {
  extensions: [new WebAuthnExtension()],
});

// Initiates the flow to a new WebAuthn Device for current account.
try {
  await magic.webauthn.registerNewDevice('new device nickname');
} catch (e) {
  // Handle errors if required!
}
```

**Error**

```javascript JavaScript icon="square-js"

import { Magic, SDKErrorCode } from "magic-sdk";
import { WebAuthnExtension } from "@magic-ext/webauthn";

const magic = new Magic('YOUR API KEY', {
extensions: [new WebAuthnExtension()],
});

try {
  await magic.webauthn.registerNewDevice('new device nickname');
} catch (err) {
  if (err instanceof SDKErrorCode) {
    switch (err.code) {
      case SDKErrorCode.WebAuthnNotSupported:
      case SDKErrorCode.WebAuthnCreateCredentialError:
      // Handle errors accordingly
      break;
    }
  }
}
```

### `updateInfo`

Allows a user to update their device nickname.

**Arguments**

- `nickname` (String): The nickname of the WebAuthn device the user wants to set
- `id` (String): The WebAuthn ID returned from `getMetaData` function's `devicesInfo` field

**Returns**

- `PromiEvent<boolean>`: The promise resolves with a true boolean value if update webauthn device nickname is successful and rejects with a specific error code if the request fails

**Example**

```javascript JavaScript icon="square-js"
import { Magic, SDKErrorCode } from "magic-sdk";
import { WebAuthnExtension } from "@magic-ext/webauthn";

const magic = new Magic('YOUR API KEY', {
  extensions: [new WebAuthnExtension()],
});

// Initiates the flow to update WebAuthn Device's nickname.
try {
  await magic.webauthn.updateInfo({ id, nickname });
} catch (e) {
  // Handle errors if required!
}
```

### `unregisterDevice`

Unregisters a user's device.

**Arguments**

- `id` (String): The WebAuthn ID returned from `getMetaData` function's `devicesInfo` field

**Returns**

- `PromiEvent<boolean>`: The promise resolves with a true boolean value if unregister webauthn device is successful and rejects with a specific error code if the request fails

**Example**

```javascript JavaScript icon="square-js"
import { Magic, SDKErrorCode } from "magic-sdk";
import { WebAuthnExtension } from "@magic-ext/webauthn";

const magic = new Magic('YOUR API KEY', {
  extensions: [new WebAuthnExtension()],
});

// Initiates the flow to unregister WebAuthn Device.
try {
  // Assuming user is logged in
  await magic.webauthn.unregisterDevice(id);
} catch (e) {
  // Handle errors if required!
}
```