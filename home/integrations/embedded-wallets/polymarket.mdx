---
title: "Polymarket"
description: "Build gasless prediction market applications with Magic and Polymarket's Builder Program"
---

## Overview

Polymarket's Builders Program enables developers to integrate prediction markets into their applications with gasless trading and builder order attribution. This guide demonstrates how to use Magic's passwordless authentication with Polymarket's CLOB Client and Builder Relayer Client.

There are two integration paths for Polymarket:

| Integration | Use Case | Repository |
|-------------|----------|------------|
| **Safe Wallet** | New users who don't have Polymarket accounts | [magic-safe-builder-example](https://github.com/Polymarket/magic-safe-builder-example) |
| **Proxy Wallet** | Existing Polymarket.com Magic Link users | [magic-proxy-builder-example](https://github.com/Polymarket/magic-proxy-builder-example) |

<Note>
Both implementations provide gasless trading with builder order attribution. Choose based on whether you're onboarding new users or integrating with existing Polymarket.com accounts.
</Note>

---

## Safe Wallet Implementation

<Info>
Use the Safe Wallet implementation for **new users** who don't have existing Polymarket.com accounts.
</Info>

The Safe Wallet approach deploys a Gnosis Safe smart contract wallet for each user, providing enhanced security and account abstraction capabilities.

<Card title="Magic Safe Builder Example" icon="github" href="https://github.com/Polymarket/magic-safe-builder-example">
Complete Next.js application showing Magic authentication with Safe wallet deployment for Polymarket trading.
</Card>

### Safe Wallet Prerequisites

Before starting, ensure you have:

1. A Magic **Publishable** API Key from your [Magic Dashboard](https://dashboard.magic.link)
2. Polymarket Builder credentials (Builder ID and signing key)
3. A Polygon RPC endpoint

### Safe Wallet Architecture

The Safe Wallet flow uses Magic SDK for authentication and the Builder Relayer Client to deploy Gnosis Safe wallets:

1. User authenticates with Magic (Email OTP or Social Login)
2. Magic SDK creates an EOA signer for the user
3. Builder Relayer Client deploys a Gnosis Safe wallet
4. Token approvals are set via the Relayer
5. User API credentials are generated by initializing a temporary ClobClient with the Magic signer and calling `deriveApiKey()` or `createApiKey()`.
6. Authenticated ClobClient is initialized for trading

### Key Differences: Safe vs Proxy

| Feature | Safe Wallet | Proxy Wallet |
|---------|-------------|--------------|
| **Target Users** | New users | Existing Polymarket.com users |
| **Wallet Type** | Gnosis Safe (multi-sig capable) | EIP-1167 Minimal Proxy |
| **Deployment** | Your app deploys via Relayer | Polymarket deployed on first trade |
| **Signature Type** | `0` (EOA) | `1` (Magic Link) |
| **Authentication** | Magic SDK login | Private key import |

<Warning>
Store Builder credentials server-side only. Never expose signing keys in client code.
</Warning>

For the complete Safe Wallet implementation with step-by-step code, see the [magic-safe-builder-example](https://github.com/Polymarket/magic-safe-builder-example) repository.

---

## Proxy Wallet Implementation

<Warning>
The Proxy Wallet implementation is only for existing Polymarket.com Magic Link users who already have accounts. Do not use this for new users.
</Warning>

This integration allows users who created accounts on polymarket.com via Magic Link (email/Google OAuth) to use the same account in your application.

<Card title="Magic Proxy Builder Example" icon="github" href="https://github.com/Polymarket/magic-proxy-builder-example">
Complete Next.js application for existing Polymarket.com Magic Link users.
</Card>

### Proxy Wallet Prerequisites

<Steps>
<Step title="Magic Link Account on Polymarket">
  Visit [polymarket.com](https://polymarket.com) and sign up via Magic Link (email/Google). Complete at least one trade to deploy your proxy wallet and set token approvals.
</Step>

<Step title="Magic Wallet Private Key">
  Visit [reveal.magic.link/polymarket](https://reveal.magic.link/polymarket) after creating the account and conducting one trade to obtain your private key.
</Step>

<Step title="Polygon RPC URL">
  Any Polygon mainnet RPC (Alchemy, Infura, or public RPC). The demo defaults to a public RPC URL.
</Step>

<Step title="USDC.e Funds">
  Send USDC.e to the **Proxy Wallet address** (not the EOA) for trading.
  
  <Warning>
  Users must fund the Proxy Wallet, not the EOA. The EOA is only used for signing.
  </Warning>
</Step>
</Steps>

### Proxy Wallet Architecture

Polymarket's Magic Link integration uses a unique wallet architecture:

| Wallet Type | Purpose | Fund This? |
|-------------|---------|------------|
| **EOA (Magic Wallet)** | Signs transactions on behalf of the proxy | No |
| **Proxy Wallet** | Holds funds (USDC.e) and executes trades | Yes |

<Info>
The Proxy Wallet is a Non-Safe EIP-1167 minimal proxy that is deterministically derived from the user's EOA using CREATE2. The same EOA always generates the same Proxy address.
</Info>

### Integration Flow

The Proxy Wallet integration follows this flow:

1. User has trading history on polymarket.com via email/Google OAuth login
2. User obtains and submits Magic wallet private key to authenticate
3. App derives deterministic Non-Safe Proxy Wallet address
4. Display both EOA (signing wallet) and Proxy (funding/trading wallet) addresses
5. Initialize ClobClient with Magic signature type (`signatureType: 1`)
6. Obtain User API Credentials using `deriveApiKey()` or `createApiKey()`
7. Initialize authenticated ClobClient with credentials
8. Ready to trade

### Quick Start

To run the [magic-proxy-builder-example](https://github.com/Polymarket/magic-proxy-builder-example) demo locally:

**Clone and Install:**

```bash
git clone https://github.com/Polymarket/magic-proxy-builder-example.git
cd magic-proxy-builder-example
npm install
```

**Environment Setup:**

Create a `.env.local` file:

```bash
# Polygon RPC endpoint
NEXT_PUBLIC_POLYGON_RPC_URL=https://polygon-rpc.com

# Or use Alchemy/Infura:
# NEXT_PUBLIC_POLYGON_RPC_URL=https://polygon-mainnet.g.alchemy.com/v2/YOUR_KEY
```

**Run Development Server:**

```bash
npm run dev
```

Open localhost to view the application.

### Implementation Steps

<Steps>
<Step title="Create Wallet from Private Key">
Users obtain their private key from reveal.magic.link and import into the app:

```typescript TypeScript icon="square-js"
import { Wallet, providers } from "ethers";

const POLYGON_RPC_URL = process.env.NEXT_PUBLIC_POLYGON_RPC_URL;

const provider = new providers.JsonRpcProvider(POLYGON_RPC_URL);
const wallet = new Wallet(privateKey, provider);
const eoaAddress = wallet.address;
```

<Warning>
This demo stores the private key in React state for simplicity. This is NOT production-ready. In production, use secure key management solutions or server-side signing.
</Warning>
</Step>

<Step title="Derive Proxy Wallet Address">

<Info>
This code is for address derivation only, your app does not deploy proxy wallets. Polymarket deploys the proxy wallet automatically when a Magic user first logs in.
</Info>

Polymarket's Magic auth creates a Non-Safe Proxy Wallet (EIP-1167 minimal proxy) deterministically derived from the EOA using CREATE2:

```typescript TypeScript icon="square-js"
import { getAddress, keccak256, concat, type Address, type Hex } from "viem";

const FACTORY = "0xaB45c5A4B0c941a2F231C04C3f49182e1A254052";
const IMPLEMENTATION = "0x44e999d5c2F66Ef0861317f9A4805AC2e90aEB4f";
const PROXY_BYTECODE_TEMPLATE = 
  "0x3d3d606380380380913d393d73%s5af4602a57600080fd5b602d8060366000396000f3" +
  "363d3d373d3d3d363d73%s5af43d82803e903d91602b57fd5bf352e831dd" +
  "00000000000000000000000000000000000000000000000000000000000000200" +
  "000000000000000000000000000000000000000000000000000000000000000";

function deriveProxyAddress(eoaAddress: string): Address {
  const proxyBytecode = PROXY_BYTECODE_TEMPLATE
    .replace("%s", FACTORY.slice(2).toLowerCase())
    .replace("%s", IMPLEMENTATION.slice(2).toLowerCase()) as Hex;

  const salt = keccak256(eoaAddress as `0x${string}`);
  const initCodeHash = keccak256(proxyBytecode);
  const hash = keccak256(
    concat(["0xff", FACTORY as Address, salt, initCodeHash])
  );

  return getAddress(`0x${hash.slice(26)}` as Address);
}
```

<Note>
The proxy address is deterministic â€” the same EOA always generates the same proxy address. Use this function to calculate where the user's funds are, not to deploy the proxy.
</Note>
</Step>

<Step title="Get User API Credentials">
Obtain credentials by creating a temporary ClobClient:

```typescript TypeScript icon="square-js"
import { ClobClient } from "@polymarket/clob-client";

const CLOB_API_URL = "https://clob.polymarket.com";
const POLYGON_CHAIN_ID = 137;

// Temporary ClobClient for credential derivation
const tempClient = new ClobClient(
  CLOB_API_URL,
  POLYGON_CHAIN_ID,
  wallet
);

// Try to derive existing credentials (returning users)
// or create new ones (first-time users)
let credentials;
try {
  credentials = await tempClient.deriveApiKey();
  if (!credentials?.key) throw new Error("Invalid");
} catch {
  credentials = await tempClient.createApiKey();
}
// credentials = { key, secret, passphrase }
```

**Credential Flow:**
- **Returning users**: `deriveApiKey()` retrieves existing credentials
- **First-time users**: `createApiKey()` creates new credentials
- Both require a user signature (EIP-712)

<Info>
Credentials can be used to view orders and cancel limit orders, but cannot place new orders without the private key. Storing credentials in localStorage is not recommended for production due to XSS risks.
</Info>
</Step>

<Step title="Initialize Authenticated ClobClient">
Create the trading client with all required parameters:

```typescript TypeScript icon="square-js"
import { ClobClient } from "@polymarket/clob-client";
import { BuilderConfig } from "@polymarket/builder-signing-sdk";

const builderConfig = new BuilderConfig({
  remoteBuilderConfig: {
    url: `${window.location.origin}/api/polymarket/sign`,
  },
});

const clobClient = new ClobClient(
  "https://clob.polymarket.com",
  137,                      // Polygon chain ID
  wallet,                   // EOA signer
  credentials,              // { key, secret, passphrase }
  1,                        // signatureType = 1 for Magic Link
  proxyAddress,             // Funder address (Proxy Wallet)
  undefined,
  false,
  builderConfig
);
```

**ClobClient Parameters:**

| Parameter | Value | Description |
|-----------|-------|-------------|
| `signatureType` | `1` | Magic Link signature type (vs. `0` for EOA/Safe) |
| `funder` | Proxy Address | The wallet that holds funds |
| `signer` | EOA Wallet | Signs transactions on behalf of proxy |
</Step>
</Steps>

---

## Placing Orders

With the authenticated ClobClient, place market and limit orders. The process is identical for both Safe and Proxy wallet implementations.

<Tabs>
<Tab title="Market Orders">
```typescript TypeScript icon="square-js"
import { Side, OrderType } from "@polymarket/clob-client";

async function submitMarketOrder(
  clobClient: ClobClient,
  tokenId: string,
  size: number,
  side: "BUY" | "SELL",
  negRisk: boolean = false
) {
  // Get current price from orderbook
  const oppositeSide = side === "BUY" ? Side.SELL : Side.BUY;
  const priceResponse = await clobClient.getPrice(tokenId, oppositeSide);
  const marketPrice = parseFloat(priceResponse.price);

  // Apply aggressive pricing for immediate fills
  let aggressivePrice: number;
  if (side === "BUY") {
    aggressivePrice = Math.min(0.99, marketPrice * 1.05); // +5% above market
  } else {
    aggressivePrice = Math.max(0.01, marketPrice * 0.95); // -5% below market
  }

  const order = {
    tokenID: tokenId,
    price: aggressivePrice,
    size: size,
    side: side === "BUY" ? Side.BUY : Side.SELL,
    feeRateBps: 0,
    expiration: 0,
    taker: "0x0000000000000000000000000000000000000000",
  };

  const response = await clobClient.createAndPostOrder(
    order,
    { negRisk },
    OrderType.GTC
  );

  return response.orderID;
}
```

<Info>
Polymarket's CLOB doesn't have true "market orders". Market orders are simulated using limit orders with aggressive pricing that fills immediately.
</Info>
</Tab>

<Tab title="Limit Orders">
```typescript TypeScript icon="square-js"
import { Side, OrderType } from "@polymarket/clob-client";

async function submitLimitOrder(
  clobClient: ClobClient,
  tokenId: string,
  price: number,
  size: number,
  side: "BUY" | "SELL",
  negRisk: boolean = false
) {
  const order = {
    tokenID: tokenId,
    price: price,         // User-specified (0.01 to 0.99)
    size: size,
    side: side === "BUY" ? Side.BUY : Side.SELL,
    feeRateBps: 0,
    expiration: 0,        // 0 = Good-til-Cancel
    taker: "0x0000000000000000000000000000000000000000",
  };

  const response = await clobClient.createAndPostOrder(
    order,
    { negRisk },
    OrderType.GTC
  );

  return response.orderID;
}
```
</Tab>
</Tabs>

**Order Execution:**
- Orders are signed by the user's EOA (Magic wallet)
- Executed from the funder address (Safe or Proxy)
- **Gasless execution** - no gas fees for users
- Prompts user signature for each order

---

## Position & Order Management

### Fetch User Positions

```typescript TypeScript icon="square-js"
// Fetch from Polymarket Data API
const walletAddress = safeAddress || proxyAddress;

const response = await fetch(
  `https://data-api.polymarket.com/positions?user=${walletAddress}&sizeThreshold=0.01&limit=500`
);
const positions = await response.json();
```

### Fetch Active Orders

```typescript TypeScript icon="square-js"
// Fetch from CLOB client
const allOrders = await clobClient.getOpenOrders();
const userOrders = allOrders.filter(
  (order) =>
    order.maker_address.toLowerCase() === walletAddress.toLowerCase() &&
    order.status === "LIVE"
);
```

### Cancel Order

```typescript TypeScript icon="square-js"
await clobClient.cancelOrder({ orderID: orderId });
```

---

## Token Addresses

Important contract addresses on Polygon:

```typescript TypeScript icon="square-js"
// USDC.e (Bridged USDC) - The trading currency
export const USDC_E_ADDRESS = "0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174";
export const USDC_E_DECIMALS = 6;

// Conditional Token Framework
export const CTF_ADDRESS = "0x4d97dcd97ec945f40cf65f87097ace5ea0476045";

// Exchanges
export const CTF_EXCHANGE = "0x4bFb41d5B3570DeFd03C39a9A4D8dE6Bd8B8982E";
export const NEG_RISK_CTF_EXCHANGE = "0xC5d563A36AE78145C45a50134d48A1215220f80a";
export const NEG_RISK_ADAPTER = "0xd91E80cF2E7be2e162c6513ceD06f1dD0dA35296";

// Proxy Wallet Factory (for Proxy implementation)
export const PROXY_FACTORY = "0xaB45c5A4B0c941a2F231C04C3f49182e1A254052";
export const PROXY_IMPLEMENTATION = "0x44e999d5c2F66Ef0861317f9A4805AC2e90aEB4f";
```

---

## Key Dependencies

| Package | Version | Purpose |
|---------|---------|---------|
| [`@polymarket/clob-client`](https://github.com/Polymarket/clob-client) | ^4.22.8 | Order placement, User API credentials |
| [`@polymarket/builder-relayer-client`](https://github.com/Polymarket/builder-relayer-client) | ^0.0.8 | Safe deployment, token approvals |
| [`@polymarket/builder-signing-sdk`](https://github.com/Polymarket/builder-signing-sdk) | ^0.0.8 | Builder configuration |
| [`magic-sdk`](https://www.npmjs.com/package/magic-sdk) | latest | Magic authentication (Safe implementation) |
| [`ethers`](https://docs.ethers.org/v5/) | ^5.8.0 | Wallet creation, signing |
| [`viem`](https://viem.sh/) | ^2.39.2 | Ethereum interactions, CREATE2 derivation |

---

## Troubleshooting

<AccordionGroup>
<Accordion title="Invalid private key (Proxy)">
**Symptoms:** Error when entering private key

**Solutions:**
- Key must start with `0x`
- Key must be 66 characters (0x + 64 hex chars)
- Get private key from [reveal.magic.link/polymarket](https://reveal.magic.link/polymarket)
- User must have trading history on polymarket.com
</Accordion>

<Accordion title="Safe deployment fails">
**Symptoms:** Cannot deploy Safe wallet

**Solutions:**
- Ensure Builder credentials are valid
- Check that the Relayer service is accessible
- Verify the Magic user is authenticated
- Check server-side logs for signing errors
</Accordion>

<Accordion title="CLOB client not initialized">
**Symptoms:** Cannot place orders, trading session incomplete

**Solutions:**
- Click "Initialize Trading Session" button
- Ensure private key or Magic authentication is valid
- Check browser console for authentication errors
- Verify User API Credentials were obtained successfully
</Accordion>

<Accordion title="Balance shows $0.00">
**Symptoms:** USDC.e balance appears as zero

**Solutions:**
- Fund the **Safe or Proxy Wallet**, not the EOA
- Check [Polygonscan](https://polygonscan.com) for confirmation
- Verify RPC endpoint is working in `.env.local`
- The wallet address is shown in the header UI
</Accordion>

<Accordion title="Orders not appearing">
**Symptoms:** Orders submitted but not visible

**Solutions:**
- Wait 2-3 seconds for CLOB sync
- Check USDC.e balance (need funds to trade)
- Verify order was submitted successfully in browser console
- Ensure the wallet is properly funded
</Accordion>

<Accordion title="Proxy wallet not deployed (Proxy only)">
**Symptoms:** Cannot trade with proxy wallet

**Solutions:**
- User must log in to polymarket.com at least once via Magic Link
- Complete at least one trade on polymarket.com first
- Polymarket deploys the proxy wallet on first trade
- The demo app does not deploy proxy wallets
</Accordion>
</AccordionGroup>

---

## Resources

<CardGroup cols={2}>
<Card title="Safe Wallet Demo" icon="github" href="https://github.com/Polymarket/magic-safe-builder-example">
  For new users - deploys Gnosis Safe wallets
</Card>

<Card title="Proxy Wallet Demo" icon="github" href="https://github.com/Polymarket/magic-proxy-builder-example">
  For existing Polymarket.com Magic Link users
</Card>

<Card title="CLOB Client Docs" icon="book" href="https://docs.polymarket.com/developers/CLOB/clients">
  Official Polymarket CLOB client documentation
</Card>

<Card title="Authentication Guide" icon="key" href="https://docs.polymarket.com/developers/CLOB/authentication">
  Learn about Polymarket's authentication flow
</Card>

<Card title="Proxy Wallets" icon="wallet" href="https://docs.polymarket.com/developers/proxy-wallet">
  Understanding Polymarket proxy wallet architecture
</Card>

<Card title="Order Placement" icon="shopping-cart" href="https://docs.polymarket.com/quickstart/orders/first-order">
  Guide to placing your first order
</Card>
</CardGroup>

---