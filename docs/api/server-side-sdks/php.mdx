---
title: PHP API Reference
sidebarTitle: PHP
---

## Overview

The Magic admin PHP SDK is your entry-point to secure, passwordless authentication for your application. This guide will cover some important topics for getting started with the PHP SDK and to make the most of Magic's features.

## Getting Started

The Magic class is the entry-point to the Magic SDK. It must be instantiated with a Magic **secret** key.

### Installation

<Tabs>
<Tab title="Bash">
```json
composer require magiclabs/magic-admin-php
```
</Tab>
</Tabs>

### Constructor

### [#`new \MagicAdmin\Magic()`](#new-magic-admin-magic)

|     |     |     |
| --- | --- | --- |
| Parameter | Type | Definition |
| `api_secret_key` | str | Your **secret** API Key retrieved from the Magic Dashboard. |
| `retries?` | num | Total number of retries to allow. |
| `timeout?` | num | A period of time the request is going to wait for a response. |
| `backoff_factor?` | num | A backoff factor to apply between retry attempts. |

### [#Initialization](#initialization)

<Tabs>
<Tab title="PHP">
```json

$magic = new \MagicAdmin\Magic(
    '<SECRET_API_KEY>',
    5,
    5,
    0.01,
);
```
</Tab>
</Tabs>

## Token Resource

The token resource and its methods are accessible on the Magic instance by the `token` attribute. It provides methods to interact with the DID Token.

note

The token resource does **not** make any API calls to the Magic server.

<Tabs>
<Tab title="PHP">
```json

$magic = new \MagicAdmin\Magic('<SECRET_API_KEY>');

$magic->token
$magic->token->get_issuer
$magic->token->get_public_address
$magic->token->decode
$magic->token->validate
```
</Tab>
</Tabs>

### `get_issuer`

Extracts the `iss` from the [DID Token](/docs/authentication/features/decentralized-id).

<Tabs>
<Tab title="PHP">
```json

token.get_issuer(did_token);
```
</Tab>
</Tabs>

### Arguments

* `did_token` (str): A DID Token generated by a Magic User on the client-side

### Raises

* `DIDTokenException` if the given DID Token is malformed

### Returns

* A Decentralized ID (`iss`) of the Magic user who generated the DID Token

### `get_public_address`

Gets the cryptographic [public address](https://support.blockchain.com/hc/en-us/articles/4417082520724-What-are-public-and-private-keys-and-how-do-they-work-) of the Magic User who generated the supplied DID Token.

<Tabs>
<Tab title="PHP">
```json

token.get_public_address(did_token);
```
</Tab>
</Tabs>

### Arguments

* `did_token` (str): A DID Token generated by a Magic user on the client-side

### Raises

* `DIDTokenException` if the given DID Token is malformed

### Returns

* A [public address](https://support.blockchain.com/hc/en-us/articles/4417082520724-What-are-public-and-private-keys-and-how-do-they-work-) of the Magic User who generated the DID Token. Currently, this value is associated with the Ethereum blockchain.

### `decode`

Decodes a DID Token from a Base64 string into a tuple of its individual components: `proof` and `claim`. This method allows you decode the DID Token and inspect the token. You can apply your own rules and validations on top of the current [token.validate](#validate) method.

<Tabs>
<Tab title="PHP">
```json

token.decode(did_token);
```
</Tab>
</Tabs>

### Arguments

* `did_token` (str): A DID Token generated by a Magic user on the client-side

### Raises

* `DIDTokenException` if the given DID Token is malformed

### Returns

* `proof` (str): A digital signature that proves the validity of the given `claim`
* `claim` (array): Unsigned data the user asserts. This should equal the `proof` after Elliptic Curve recovery. See [Decentralized Token Specification](/docs/authentication/features/decentralized-id#decentralized-id-token-specification) for fields inside the `claim`.

### `validate`

Validates a DID token.

<Tabs>
<Tab title="PHP">
```json

token.validate(did_token);
```
</Tab>
</Tabs>

### Arguments

* `did_token` (str): A DID Token generated by a Magic user on the client-side

### Raises

* `DIDTokenException` if the given DID Token is invalid or malformed

### Returns

* _None_

## User Resource

The user resource and its methods are accessible on the Magic instance by the `user` attribute. It provides methods to interact with the User.

<Tabs>
<Tab title="PHP">
```json

$magic = new \MagicAdmin\Magic('<SECRET_API_KEY>');

$magic->user
$magic->user->get_metadata_by_issuer
$magic->user->get_metadata_by_public_address
$magic->user->get_metadata_by_token
$magic->user->logout_by_issuer
$magic->user->logout_by_public_address
$magic->user->logout_by_token
```
</Tab>
</Tabs>

[#`get_metadata_by_issuer`](#get_metadata_by_issuer)
----------------------------------------------------

Retrieves information about the user by the supplied `iss` from the DID Token. This method is useful if you store the `iss` with your user data, **which is recommended**.

<Tabs>
<Tab title="PHP">
```json

user.get_metadata_by_issuer(issuer);
```
</Tab>
</Tabs>

### Arguments

* `issuer` (str): The user's Decentralized ID, which can be parsed using [token.get_issuer](#get_issuer)

### Raises

* `RateLimitingException`: If you have sent too many requests within a given period of time
* `BadRequestException`: If the supplied parameters are invalid
* `AuthenticationException`: If your API **secret** key cannot be authenticated with Magic API server
* `ForbiddenException`: If your API **secret** key is not authorized to access the resources
* `ApiException`: For any other API error
* `ApiConnectionException`: If your server cannot communicate with the Magic server. Normally this is a network communication error.

<Note>
See [Error Handling](#response-and-error-handling) for more examples.
</Note>
### Returns

* A [`MagicResponse`](#magicresponse): The `data` field contains all of the user meta information.
    * `issuer` (str): The user's Decentralized ID
    * `public_address` (str): The authenticated user's public address (a.k.a.: public key). Currently, this value is associated with the Ethereum blockchain.
    * `email` (str): The user's email address
    * `phone_number` (str): The user's phone number
    * `oauth_provider` (str): OAuth provider, if any
    * `wallets` (arr): Array of user's wallet addresses

### `get_metadata_by_public_address`


Retrieves information about the user by the supplied `public_address`. This method is useful if you store the `public_address` with your user data.

<Tabs>
<Tab title="PHP">
```json

user.get_metadata_by_public_address(public_address);
```
</Tab>
</Tabs>

### Arguments

* `public_address` (str): The user's Ethereum public address, which can be parsed using [token.get\_public\_address](#get_public_address)

### Raises

* `RateLimitingException`: If you have sent too many requests within a given period of time
* `BadRequestException`: If the supplied parameters are invalid
* `AuthenticationException`: If your API **secret** key cannot be authenticated with Magic API server
* `ForbiddenException`: If your API **secret** key is not authorized to access the resources
* `ApiException`: For any other API error
* `ApiConnectionException`: If your server cannot communicate with the Magic server. Normally this is a network communication error.

<Note>
See [Error Handling](#response-and-error-handling) for more examples.
</Note>
### Returns

* A [`MagicResponse`](#magicresponse): The `data` field contains all of the user meta information.
    * `issuer` (str): The user's Decentralized ID
    * `public_address` (str): The authenticated user's public address (a.k.a.: public key). Currently, this value is associated with the Ethereum blockchain.
    * `email` (str): The user's email address
    * `phone_number` (str): The user's phone number
    * `oauth_provider` (str): OAuth provider, if any
    * `wallets` (arr): Array of user's wallet addresses

### `get_metadata_by_token`

Retrieves information about the user by the supplied DID Token.

<Tabs>
<Tab title="PHP">
```json

user.get_metadata_by_token(did_token);
```
</Tab>
</Tabs>

### Arguments

* `did_token` (str): A DID Token generated by a Magic User on the client-side

### Raises

* `RateLimitingException`: If you have sent too many requests within a given period of time
* `BadRequestException`: If the supplied parameters are invalid
* `AuthenticationException`: If your API **secret** key cannot be authenticated with Magic API server
* `ForbiddenException`: If your API **secret** key is not authorized to access the resources
* `ApiException`: For any other API error
* `ApiConnectionException`: If your server cannot communicate with the Magic server. Normally this is a network communication error.

<Note>
See [Error Handling](#response-and-error-handling) for more examples.
</Note>

### Returns

* A [`MagicResponse`](#magicresponse): The `data` field contains all of the user meta information.
    * `issuer` (str): The user's Decentralized ID
    * `public_address` (str): The authenticated user's public address (a.k.a.: public key). Currently, this value is associated with the Ethereum blockchain.
    * `email` (str): The user's email address
    * `phone_number` (str): The user's phone number
    * `oauth_provider` (str): OAuth provider, if any
    * `wallets` (arr): Array of user's wallet addresses

### `logout_by_issuer`

Logs a user out of all Magic SDK sessions given the user's Decentralized ID (`iss`). This method is useful if you store the `iss` with your user data, which is recommended.

<Tabs>
<Tab title="PHP">
```json
user.logout_by_issuer(issuer);
```
</Tab>
</Tabs>

### Arguments

* `issuer` (str): The user's Decentralized ID, which can be parsed using [token.get_issuer](#get_issuer)

### Raises

* `RateLimitingException`: If you have sent too many requests within a given period of time
* `BadRequestException`: If the supplied parameters are invalid
* `AuthenticationException`: If your API **secret** key cannot be authenticated with Magic API server
* `ForbiddenException`: If your API **secret** key is not authorized to access the resources
* `ApiException`: For any other API error
* `ApiConnectionException`: If your server cannot communicate with the Magic server. Normally this is a network communication error.


<Note>
See [Error Handling](#response-and-error-handling) for more examples.
</Note>
### Returns

* A [`MagicResponse`](#magicresponse)

### `logout_by_public_address`

Logs a user out of all Magic SDK sessions given the user's public address. This method is useful if you store the `public_address`.

<Tabs>
<Tab title="PHP">
```json
user.logout_by_public_address(public_address);
```
</Tab>
</Tabs>

### Arguments

* `public_address` (str): The user's Ethereum public address

### Raises

* `RateLimitingException`: If you have sent too many requests within a given period of time
* `BadRequestException`: If the supplied parameters are invalid
* `AuthenticationException`: If your API **secret** key cannot be authenticated with Magic API server
* `ForbiddenException`: If your API **secret** key is not authorized to access the resources
* `ApiException`: For any other API error
* `ApiConnectionException`: If your server cannot communicate with the Magic server. Normally this is a network communication error.

<Note>
See [Error Handling](#response-and-error-handling) for more examples.
</Note>
### Returns

* A [`MagicResponse`](#magicresponse)

### `logout_by_token`

Logs a user out of all Magic SDK sessions given the DID Token.

<Tabs>
<Tab title="PHP">
```json

user.logout_by_token(did_token);
```
</Tab>
</Tabs>

### Arguments

* `did_token` (str): A DID Token generated by a Magic user on the client-side

### Raises

* `RateLimitingException`: If you have sent too many requests within a given period of time
* `BadRequestException`: If the supplied parameters are invalid
* `AuthenticationException`: If your API **secret** key cannot be authenticated with Magic API server
* `ForbiddenException`: If your API **secret** key is not authorized to access the resources
* `ApiException`: For any other API error
* `ApiConnectionException`: If your server cannot communicate with the Magic server. Normally this is a network communication error.


<Note>
See [Error Handling](#response-and-error-handling) for more examples.
</Note>

### Returns

* A [`MagicResponse`](#magicresponse)

### Response and Error Handling

### Response

There is only one response object that will be returned from a successful API call.

### MagicResponse

This is the interface to interact Magic API responses. It will only be returned if the API request status code is between 200 (inclusive) and 300 (exclusive).

You will have access to the following attributes:

* `content` (Array): Raw content returned by the API response
* `status_code` (num): HTTP status code for the given request
* `data` (Array): Parsed content

<Tabs>
<Tab title="PHP">
```json

MagicResponse->content
MagicResponse->status_code
MagicResponse->data
```
</Tab>
</Tabs>

### Errors

The conventional HTTP response is adopted by the SDK. For the status code in:

* `2XX` \- Indicates success
* `4XX` \- Indicates client errors. Information provided to the SDK is invalid.
* `5XX` \- Indicates server errors

Below is the error class inheritance which can help developers to programmatically handle the error cases.

```json

MagicException
    |
    |------- DIDTokenException
    |
    |------- RequestException
                  |
                  | ------- RateLimitingException
                  | ------- BadRequestException
                  | ------- AuthenticationException
                  | ------- ForbiddenException
                  | ------- ApiException
                  | ------- ApiConnectionException
```

### MagicException

This is the base class of all the Magic SDK errors.

<Tabs>
<Tab title="PHP">
```json

MagicException(message=null);
```
</Tab>
</Tabs>

### DIDTokenException

Any DID Token related error. This can mean the given token is malformed or invalid.

### RequestException

This is the base class of all the Magic API request errors. This error class will provide details of unsuccessful API requests.

<Tabs>
<Tab title="PHP">
```json

RequestException(
    $message=null,
    $http_status=null,
    $http_code=null,
    $http_resp_data=null,
    $http_message=null,
    $http_error_code=null,
    $http_request_params=null,
    $http_request_data=null,
    $http_method=null
);
```
</Tab>
</Tabs>

|     |     |     |
| --- | --- | --- |
| Code | Error | Description |
| 429 | `RateLimitingException` | Too many requests are submitted for a given period of time. |
| 400 | `BadRequestException` | The API requests might have missing required fields or bad inputs. |
| 401 | `AuthenticationException` | This means your API **secret** key is invalid. |
| 403 | `ForbiddenException` | This normally means the given API **secret** key doesn't have permission to perform the action on the given resources. |
| –   | `ApiException` | This is a generic API error that handlers other status codes that are not explicitly handled. Ex: `500` , `404` , etc. |
| –   | `ApiConnectionException` | Network connection error. This normally means the connection between your application and Magic API server cannot be established. |

### Error Handling

It is recommended to implement error handling for API responses.

<Tabs>
<Tab title="PHP">
```json

try{
    // Make requests to Magic server.
}
catch (\MagicAdmin\Exception\DIDTokenException $e) {
    // throw the exception
}
catch (\MagicAdmin\Exception\RateLimitingException $e) {
    // throw the exception
}
catch (\MagicAdmin\Exception\BadRequestException $e) {
    // throw the exception
}
catch (\MagicAdmin\Exception\AuthenticationException $e) {
    // throw the exception
}
catch (\MagicAdmin\Exception\ForbiddenException $e) {
    // throw the exception
}
catch (\MagicAdmin\Exception\ApiException $e) {
    // throw the exception
}
catch (\MagicAdmin\Exception\ApiConnectionException $e) {
    // throw the exception
}
```
</Tab>
</Tabs>

## Resources

* [GitHub](https://github.com/magiclabs/magic-admin-php)

## Versions

All changes to the SDK are covered in our [latest release notes](https://github.com/magiclabs/magic-admin-php/releases).

