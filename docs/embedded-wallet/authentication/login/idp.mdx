---
title: Bring Your Own IDP
---

<Card>
  This feature requires a subscription to Growth Plan.

  <Button href="https://magic.link/pricing#features">View pricing</Button>
</Card>

## Overview

<Note>
  To enable this feature, please contact our Customer Success team using the
  help widget in the bottom-right corner of this page.
</Note>

Our OIDC extension integrates with your existing identity provider using OpenID Connect for authentication. It enables third-party identity providers to securely pass signed JWTs (OIDC tokens) for verification by Magic. This facilitates user authentication and registration while granting access to web3-capable wallets across 20+ blockchains.

### Compatibility

OIDC extension methods are available on the following client-side SDKs:

- [Web](/docs/embedded-wallet/api/client-side-sdks/web#open-id-module)
- [iOS](/docs/embedded-wallet/api/client-side-sdks/ios#open-id-module)
- [Android](/docs/embedded-wallet/api/client-side-sdks/android#open-id-module)
- [React Native](/docs/embedded-wallet/api/client-side-sdks/react-native#open-id-module)
- [Flutter](/docs/embedded-wallet/api/client-side-sdks/flutter#open-id-module)

### What is Open ID Connect?

OpenID Connect 1.0 is an identity layer built on top of the OAuth 2.0 protocol. It allows clients to confirm a user's identity through authentication by an authorization server and obtain fundamental profile details in a standardized, REST-like format.

For more information about this identity protocol, please visit [the Open ID docs](https://auth0.com/resources/webinars/intro-openid-connect).

## Configuration

Before getting started using a custom identity provider, you will need to acquire the following values that Magic relies on to connect with those providers.

|                               |        |                     |                                                                                                                                 |
| ----------------------------- | ------ | ------------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| Property                      | Type   | Required (POST)     | Description                                                                                                                     |
| **Issuer**                    | String | Yes                 | The URL of the token issuer.                                                                                                    |
| **audience**                  | String | Yes                 | The identifier of the audience, often the same as the IdP client ID to which the token is issued.                               |
| **display_name**              | String | Yes                 | A human-readable identifier for the entity.                                                                                     |
| **sandbox_mode**              | Bool   | No (defaults false) | When true, provider does not enforce the expiry claim during ID token validation, which can be useful for testing environments. |
| **Magic Publishable API Key** | String | Yes                 | The publishable API key retrieved from the Magic dashboard.                                                                     |

<Note>
  The flow to finding the required information will vary depending on your
  identity provider. Please refer to the README in one of the various OIDC demos
  pertaining to your specific identity provider.
</Note>
With this information, you can configure your application's custom identity provider
by calling our API with the Magic secret key sent in the `X-Magic-Secret-Key` header.

Upon successful configuration in Magic's backend, the API will return a `providerId`, which is a string of letters and numbers. Please save this, you will need this value each time you provision a wallet for your end user.

## Endpoints

Please call the POST endpoint for initial configuration of your application's custom identity provider with Magic. Subsequent updates can be accomplished by calling the PATCH endpoint.

- POST Endpoint: `https://api.magic.link/v1/api/magic_client/federated_idp`

**Example POST call**

<CodeGroup>
```javascript JavaScript icon="square-js"
const magic_resp = await fetch("https://api.magic.link/v1/api/magic_client/federated_idp", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "X-Magic-Secret-Key": "<sk_live_xxxxxxx>",
  },
  body: JSON.stringify({
    issuer: "https://auth.examplecorp.com",
    audience: "Xk8v3hjZP5RfzqWb4JtMn0E2sYpL9A1u",
    display_name: "example-corp-dev",
    sandbox_mode: true
  })
})

const magic_json = await magic_resp.json()
const provider_Id = magic_json.data['id']

// Responds 200 OK with new provider on successful create
{
  "data": {
    "audience": "Xk8v3hjZP5RfzqWb4JtMn0E2sYpL9A1u",
    "discovery_uri": "https://auth.examplecorp.com/.well-known/openid-configuration",
    "display_name": "example-corp-dev",
    "id": "3LDeve5f56ouY_tN-jLJlop_hkLI1LLTNG8abaCD42E=",
    "is_active": true,
    "issuer": "https://auth.examplecorp.com",
    "jwks_uri": "https://auth.examplecorp.com/jwks.json",
    "jwkset": null,
    "magic_client": null,
    "magic_client_id": "3LDeve5f56ouY_tN-jLJlop_hkLI1LLTNG8abaCD42E=",
    "profile": "custom",
    "sandbox_mode": true,
    "store_verified_email_enabled": false,
    "time_created": 1707238543,
    "time_updated": 1707238543,
    "type": "jwt"
  },
  "error_code": "",
  "message": "",
  "status": "ok"
}
```

```bash cURL icon="square-terminal"
curl --request POST \
  --url 'https://api.magic.link/v1/api/magic_client/federated_idp' \
  --header 'X-Magic-Secret-Key: <your_magic_secret_api_key>' \
  --header 'Content-Type: application/json' \
  --data '{
    "issuer": "https://auth.examplecorp.com",
    "audience": "Xk8v3hjZP5RfzqWb4JtMn0E2sYpL9A1u",
    "display_name": "example-corp-dev",
    "sandbox_mode": true
  }'

# Responds 200 OK with new provider on successful create
{
  "data": {
    "audience": "Xk8v3hjZP5RfzqWb4JtMn0E2sYpL9A1u",
    "discovery_uri": "https://auth.examplecorp.com/.well-known/openid-configuration",
    "display_name": "example-corp-dev",
    "id": "3LDeve5f56ouY_tN-jLJlop_hkLI1LLTNG8abaCD42E=",
    "is_active": true,
    "issuer": "https://auth.examplecorp.com",
    "jwks_uri": "https://auth.examplecorp.com/jwks.json",
    "jwkset": null,
    "magic_client": null,
    "magic_client_id": "3LDeve5f56ouY_tN-jLJlop_hkLI1LLTNG8abaCD42E=",
    "profile": "custom",
    "sandbox_mode": true,
    "store_verified_email_enabled": false,
    "time_created": 1707238543,
    "time_updated": 1707238543,
    "type": "jwt"
  },
  "error_code": "",
  "message": "",
  "status": "ok"
}
```
</CodeGroup>

To update, you will need to affix your application's `providerId` to the PATCH endpoint. Only values passed to the request body will be updated.

- PATCH Endpoint: `https://api.magic.link/v1/api/magic_client/federated_idp/<provider_Id>`

**Example PATCH call**

<CodeGroup>
```javascript JavaScript icon="square-js"
const magic_resp = await fetch("https://api.magic.link/v1/api/magic_client/federated_idp/<provider_Id>", {
  method: "PATCH",
  headers: {
    "Content-Type": "application/json",
    "X-Magic-Secret-Key": "<sk_live_xxxxxxx>",
  },
  body: JSON.stringify({
    issuer: "https://auth.examplecorp2.com",
    display_name: "example-corp2-dev",
    sandbox_mode: false
  })
})
// Only values passed to body will be updated

const magic_json = await magic_resp.json()
const provider_Id = magic_json.data['id']

// Responds 200 OK with updated provider on successful patch
{
  "data": {
    "audience": "Xk8v3hjZP5RfzqWb4JtMn0E2sYpL9A1u",
    "discovery_uri": "https://auth.examplecorp2.com/.well-known/openid-configuration",
    "display_name": "example-corp2-dev",
    "id": "3LDeve5f56ouY_tN-jLJlop_hkLI1LLTNG8abaCD42E=",
    "is_active": true,
    "issuer": "https://auth.examplecorp2.com",
    "jwks_uri": "https://auth.examplecorp2.com/jwks.json",
    "jwkset": null,
    "magic_client": null,
    "magic_client_id": "3LDeve5f56ouY_tN-jLJlop_hkLI1LLTNG8abaCD42E=",
    "profile": "custom",
    "sandbox_mode": false,
    "store_verified_email_enabled": false,
    "time_created": 1707238543,
    "time_updated": 1707238544,
    "type": "jwt"
  },
  "error_code": "",
  "message": "",
  "status": "ok"
}
```

```bash cURL icon="square-terminal"
curl --request POST \
  --url 'https://api.magic.link/v1/api/magic_client/federated_idp/<provider_Id>' \
  --header 'X-Magic-Secret-Key: <your_magic_secret_api_key>' \
  --header 'Content-Type: application/json' \
  --data '{
    "issuer": "https://auth.examplecorp2.com",
    "display_name": "example-corp2-dev",
    "sandbox_mode": false
  }'

// Responds 200 OK with updated provider on successful patch
{
  "data": {
    "audience": "Xk8v3hjZP5RfzqWb4JtMn0E2sYpL9A1u",
    "discovery_uri": "https://auth.examplecorp2.com/.well-known/openid-configuration",
    "display_name": "example-corp2-dev",
    "id": "3LDeve5f56ouY_tN-jLJlop_hkLI1LLTNG8abaCD42E=",
    "is_active": true,
    "issuer": "https://auth.examplecorp2.com",
    "jwks_uri": "https://auth.examplecorp2.com/jwks.json",
    "jwkset": null,
    "magic_client": null,
    "magic_client_id": "3LDeve5f56ouY_tN-jLJlop_hkLI1LLTNG8abaCD42E=",
    "profile": "custom",
    "sandbox_mode": false,
    "store_verified_email_enabled": false,
    "time_created": 1707238543,
    "time_updated": 1707238544,
    "type": "jwt"
  },
  "error_code": "",
  "message": "",
  "status": "ok"
}
```
</CodeGroup>

## Installation

To use your own identity provider, you must install both `magic-sdk` and the OIDC extension: `@magic-ext/oidc`

<CodeGroup>
  ```bash NPM icon="npm"
  npm install magic-sdk @magic-ext/oidc
  ```

  ```bash Yarn icon="yarn"
  yarn add magic-sdk @magic-ext/oidc
  ```
</CodeGroup>

## Initialization

### Import Required Modules

Import the necessary modules into your application. You&apos;ll need the `magic-sdk`, `@magic-ext/oidc`, and your identity provider&apos;s OIDC client library. Here&apos;s an example in JavaScript:

```javascript JavaScript icon="square-js"
import { Magic } from "magic-sdk"; 
import { OpenIdExtension } from "@magic-ext/oidc"; 
// this is an example of an OIDC client library 
import { useAuth0 } from "@auth0/auth0-react"; 
```

### Initialize the Magic SDK

Create an instance of the Magic SDK with your API key. Ensure that you include the `OpenIdExtension` to enable OIDC functionality:

```javascript JavaScript icon="square-js"
const magic = new Magic('<your_magic_api_key>', {
  // exposes the openid module in your magic instance
  extensions: [new OpenIdExtension()],
});
```

## Usage

Now that you've set up a Magic client, you can proceed to authenticate users via your preferred OIDC Client:

```javascript JavaScript icon="square-js"
// identity providers have different ways to authenticate a user
// this is an example of an OIDC client library's login methods
import { useAuth0 } from "@auth0/auth0-react";

const { loginWithRedirect } = useAuth0();

async function loginUser() {
  await loginWithRedirect();
};
```

After authentication, you can obtain the OIDC token from the identity provider. Pass this token, along with the `providerId`, to the Magic method `loginWithOIDC`:

```javascript JavaScript icon="square-js"
// identity providers have varying ways to obtain an OIDC token
// this is an example of an OIDC client library's token methods
import { useAuth0 } from "@auth0/auth0-react";

async function getMagicWallet() {
  const { getIdTokenClaims } = useAuth0();

  const token = await getIdTokenClaims();
  // resolves a DID token and stores a valid session to browser
  const didToken = await magic.openid.loginWithOIDC({
    jwt: token.__raw,
    providerId: '<your_magic_provider_id>',
  });
};
```

You can also utilize relevant Magic client SDK methods in the User Module to extend further functionality:

```javascript JavaScript icon="square-js"
// metadata will only contain issuer and publicAddress 
const metadata = await magic.user.getInfo(); 
// DID token default lifespan 15 minutes 
const didToken = await magic.user.getIdToken(); 
// returns true if auth user has a valid Magic session 
const boolean = await magic.user.isLoggedIn();
```

A full example incorporating web3 and Magic OIDC:

```javascript JavaScript icon="square-js"
import Web3 from 'web3';
import { Magic } from 'magic-sdk';
import { OpenIdExtension } from '@magic-ext/oidc';

const magic = new Magic('<your_magic_api_key>', {
  extensions: [new OpenIdExtension()],
});

const DID = await magic.openid.loginWithOIDC({
  // this oidcToken comes from the identity provider
  jwt: oidcToken,
  // this providerId is provided by Magic
  providerId: myProviderId,
});

const web3 = new Web3(magic.rpcProvider);
await web3.eth.getAccounts();
```

### Errors

The following are OIDC Extension Specific errors.

#### Given fields are invalid

`Magic RPC Error: [-32603] Internal error: Given fields are invalid: ['provider_id']`

⁠This error will be thrown if you try calling `loginWithOIDC` and pass in an incorrect `providerId`.

#### Given federated identity token is invalid or malformed

`Magic RPC Error: [-32603] Internal error: Given federated identity token is invalid or malformed`

This error can be thrown when the OIDC token is invalid in some way. The token could simply be malformed, or the token could be correct, but has mismatched provider claims. In other cases, depending on the identity provider, the Issuer Domain may require a slash to be appended or removed. It could also be that the sub does not match the provider sub.

## Resources

* [Auth0 demo](https://425tmh.csb.app/)
* [Cognito demo](https://45z33v.csb.app/)

