---
title: "Express API"
description: "Complete reference for Magic's API Wallets Express API - a secure wallet management service that handles key management internally using trusted execution environment technology"
---

## Base URL

All API requests should be made to:

```
https://tee.express.magiclabs.com
```

## Authentication

API Wallets Express requires multiple authentication headers for secure access:

<ParamField header="Authorization" type="string" required>
Bearer token (JWT) for user authentication. Format: `Bearer YOUR_JWT_TOKEN`
</ParamField>

<ParamField header="X-Magic-API-Key" type="string">
Your Magic API key for service authentication.
</ParamField>

<ParamField header="X-Magic-Secret-Key" type="string">
Alternative to API key - your Magic secret key for service authentication.
</ParamField>

<ParamField header="X-OIDC-Provider-ID" type="string" required>
The OIDC provider ID for your application.
</ParamField>

<Warning>
You must provide either `X-Magic-API-Key` or `X-Magic-Secret-Key` along with the other required headers.
</Warning>

## Wallet Endpoints

### Get or Create Wallet

Get or create a wallet for the given chain and return its public address.

```bash cURL icon="square-terminal"
curl -X POST 'https://tee.express.magiclabs.com/v1/wallet' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjNhYVl5dGR3d2UwMzJzMXIzVElyOSJ9...' \
  -H 'X-Magic-API-Key: your-magic-api-key' \
  -H 'X-OIDC-Provider-ID: your-oidc-provider-id' \
  -d '{
    "chain": "ETH"
  }'
```


**Parameters:**

<ParamField body="chain" type="string" required>
The blockchain to create the wallet for. Available values: `ETH`, `SOL`, `BTC`
</ParamField>

<ParamField body="should_sync_to_fortmatic" type="boolean" default="true">
Whether to sync the wallet to Fortmatic for backwards compatibility.
</ParamField>

**Response:**

<ResponseField name="public_address" type="string">
The newly created wallet's public address.
</ResponseField>

```json
{
  "public_address": "0x6b422EefBFBc47a6900A1fc5454Ef4b940B7e36e"
}
```

## Sign Endpoints

### Sign Data

Sign a hash of arbitrary data using the wallet's private key.

```bash cURL icon="square-terminal"
curl -X POST 'https://tee.express.magiclabs.com/v1/wallet/sign/data' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjNhYVl5dGR3d2UwMzJzMXIzVElyOSJ9...' \
  -H 'X-Magic-API-Key: your-magic-api-key' \
  -H 'X-OIDC-Provider-ID: your-oidc-provider-id' \
  -d '{
    "chain": "ETH",
    "raw_data_hash": "0xabc123def4567890abc123def4567890abc123def4567890abc123def4567890"
  }'
```

**Parameters:**

<ParamField body="chain" type="string" required>
The blockchain to sign for. Available values: `ETH`, `SOL`, `BTC`
</ParamField>

<ParamField body="raw_data_hash" type="string" required>
The keccak256 hash of the data to sign (hex string with 0x prefix).
</ParamField>

**Response:**

<ResponseField name="message_hash" type="string">
The hash that was signed.
</ResponseField>

<ResponseField name="signature" type="string">
The complete signature in hex format.
</ResponseField>

<ResponseField name="r" type="string">
The r component of the ECDSA signature.
</ResponseField>

<ResponseField name="s" type="string">
The s component of the ECDSA signature.
</ResponseField>

<ResponseField name="v" type="string">
The recovery parameter of the ECDSA signature.
</ResponseField>

```json
{
  "message_hash": "0xabc123def4567890abc123def4567890abc123def4567890abc123def4567890",
  "signature": "0x8e7d6c5b4a3928172635445566778899aabbccddeeff00112233445566778899",
  "r": "0x3d4e5f678901234567890abcdef1234567890abcdef1234567890abcdef1234",
  "s": "0x4e5f678901234567890abcdef1234567890abcdef1234567890abcdef123456",
  "v": "27"
}
```

### Sign Message

Sign an arbitrary message using the wallet's private key. Useful for authentication and off-chain verification.

```bash cURL icon="square-terminal"
curl -X POST 'https://tee.express.magiclabs.com/v1/wallet/sign/message' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjNhYVl5dGR3d2UwMzJzMXIzVElyOSJ9...' \
  -H 'X-Magic-API-Key: your-magic-api-key' \
  -H 'X-OIDC-Provider-ID: your-oidc-provider-id' \
  -d '{
    "chain": "ETH",
    "message_base64": "bm9uZQ=="
  }'
```

**Parameters:**

<ParamField body="chain" type="string" required>
The blockchain to sign for. Available values: `ETH`, `SOL`, `BTC`
</ParamField>

<ParamField body="message_base64" type="string" required>
The message to sign, encoded as base64.
</ParamField>

**Response:**

<ResponseField name="signature" type="string">
The complete signature in hex format.
</ResponseField>

<ResponseField name="r" type="string">
The r component of the ECDSA signature.
</ResponseField>

<ResponseField name="s" type="string">
The s component of the ECDSA signature.
</ResponseField>

<ResponseField name="v" type="string">
The recovery parameter of the ECDSA signature.
</ResponseField>

```json
{
  "signature": "0x0cebb670d8375ac74122b46c44def7e1ce593e80434a3e6557108ae124f8b44f3c5068fc104279fe7f51918cbe4c249d707bc1c0ce2ffb6d201d3cf4e2fdee8d1b",
  "r": "0x0cebb670d8375ac74122b46c44def7e1ce593e80434a3e6557108ae124f8b44f",
  "s": "0x3c5068fc104279fe7f51918cbe4c249d707bc1c0ce2fdee8d",
  "v": "27"
}
```

## Data Hashing for Signing

When signing messages or data, you need to properly encode your data:

### Message Signing

For signing messages, encode your data as base64:

```javascript Personal Sign
const personalSign = async (data: string) => {
  const message = Buffer.from(data, 'utf-8').toString('base64');
  const body = { message_base64: message, chain: 'ETH' };
  return await fetch('/v1/wallet/sign/message', { 
    method: 'POST', 
    body: JSON.stringify(body) 
  });
};
```

### Data Signing

For signing transaction data or other structured data, provide a keccak256 hash:

<CodeGroup>
```javascript Typed Data V1
import { typedSignatureHash } from '@metamask/eth-sig-util';

const signTypedDataV1 = async (data: TypedDataV1) => {
  const rawDataHash = typedSignatureHash(data);
  const body = { raw_data_hash: rawDataHash, chain: 'ETH' };
  return await fetch('/v1/wallet/sign/data', { 
    method: 'POST', 
    body: JSON.stringify(body) 
  });
};
```

```javascript Typed Data V3/V4
import {
  MessageTypes,
  SignTypedDataVersion,
  TypedDataUtils,
  TypedMessage,
} from '@metamask/eth-sig-util';

const computeEip712Hash = (
  data: TypedMessage<MessageTypes>,
  version: SignTypedDataVersion.V3 | SignTypedDataVersion.V4,
): string => {
  const hashBuffer = TypedDataUtils.eip712Hash(data, version);
  return '0x' + hashBuffer.toString('hex');
};

const signTypedDataV3 = async (data: TypedMessage<MessageTypes>) => {
  const rawDataHash = computeEip712Hash(data, SignTypedDataVersion.V3);
  const body = { raw_data_hash: rawDataHash, chain: 'ETH' };
  return await fetch('/v1/wallet/sign/data', { 
    method: 'POST', 
    body: JSON.stringify(body) 
  });
};

const signTypedDataV4 = async (data: TypedMessage<MessageTypes>) => {
  const rawDataHash = computeEip712Hash(data, SignTypedDataVersion.V4);
  const body = { raw_data_hash: rawDataHash, chain: 'ETH' };
  return await fetch('/v1/wallet/sign/data', { 
    method: 'POST', 
    body: JSON.stringify(body) 
  });
};
```

```javascript Transaction Signing
import { resolveProperties, Signature, Transaction, TransactionLike, TransactionRequest } from 'ethers';

const signTransaction = async (tx: TransactionRequest) => {
  const resolvedTx = await resolveProperties(tx);
  const txForSigning = { ...resolvedTx };
  delete txForSigning.from;

  const btx = Transaction.from(txForSigning as TransactionLike);

  const body = { raw_data_hash: btx.unsignedHash, chain: 'ETH' };
  const res = await fetch('/v1/wallet/sign/data', { 
    method: 'POST', 
    body: JSON.stringify(body) 
  });
  const { r, s, v } = res.json();
  btx.signature = Signature.from({ r, s, v });
  return btx.serialized;
};
```
</CodeGroup>

## Error Handling

The API uses standard HTTP status codes and returns detailed error information for validation errors:

**Validation Error (422):**
```json
{
  "detail": [
    {
      "loc": ["string", 0],
      "msg": "string", 
      "type": "string"
    }
  ]
}
```

<ResponseField name="detail" type="array">
Array of validation error details.

<Expandable title="Error detail properties">
  <ResponseField name="loc" type="array">
  Location of the error in the request (path to the invalid field).
  </ResponseField>
  
  <ResponseField name="msg" type="string">
  Human-readable error message.
  </ResponseField>
  
  <ResponseField name="type" type="string">
  Machine-readable error type identifier.
  </ResponseField>
</Expandable>
</ResponseField>

